<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fine tuning of new_frontera cluster &mdash; new_frontera 0.9.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DNS Service" href="dns-service.html" />
    <link rel="prev" title="Recording a Scrapy crawl" href="scrapy-recorder.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            new_frontera
          </a>
              <div class="version">
                0.9
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">new_frontera at a glance</a></li>
<li class="toctree-l1"><a class="reference internal" href="run-modes.html">Run modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick-start-single.html">Quick start single process</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick-start-distributed.html">Quick start distributed mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="cluster-setup.html">Cluster setup guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="strategies.html">Crawling strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="frontier-objects.html">Frontier objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="frontier-middlewares.html">Middlewares</a></li>
<li class="toctree-l1"><a class="reference internal" href="frontier-canonicalsolvers.html">Canonical URL Solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="frontier-backends.html">Backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="message_bus.html">Message bus</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_crawling_strategy.html">Writing custom crawling strategy</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrapy-integration.html">Using the Frontier with Scrapy</a></li>
<li class="toctree-l1"><a class="reference internal" href="new_frontera-settings.html">Settings</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="what-is-cf.html">What is a Crawl Frontier?</a></li>
<li class="toctree-l1"><a class="reference internal" href="graph-manager.html">Graph Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrapy-recorder.html">Recording a Scrapy crawl</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Fine tuning of new_frontera cluster</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#why-crawling-speed-is-so-low">Why crawling speed is so low?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tuning-hbase">Tuning HBase</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tuning-kafka">Tuning Kafka</a></li>
<li class="toctree-l2"><a class="reference internal" href="#flow-control-between-various-components">Flow control between various components</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dns-service.html">DNS Service</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="frontier-api.html">new_frontera API</a></li>
<li class="toctree-l1"><a class="reference internal" href="requests-integration.html">Using the Frontier with Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests.html">Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="loggers.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="frontier-tester.html">Testing a Frontier</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contribution guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">new_frontera</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Fine tuning of new_frontera cluster</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/topics/fine-tuning.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="fine-tuning-of-new-frontera-cluster">
<h1>Fine tuning of new_frontera cluster<a class="headerlink" href="#fine-tuning-of-new-frontera-cluster" title="Permalink to this heading">¶</a></h1>
<section id="why-crawling-speed-is-so-low">
<h2>Why crawling speed is so low?<a class="headerlink" href="#why-crawling-speed-is-so-low" title="Permalink to this heading">¶</a></h2>
<p>Search for a bottleneck.</p>
<ul class="simple">
<li><p>All requests are targeted towards a few websites.</p></li>
<li><p>DNS resolution (see <a class="reference internal" href="dns-service.html"><span class="doc">DNS Service</span></a> article),</p></li>
<li><p><a class="reference internal" href="glossary.html#term-strategy-worker"><span class="xref std std-term">strategy worker</span></a> performance,</p></li>
<li><p><a class="reference internal" href="glossary.html#term-db-worker"><span class="xref std std-term">db worker</span></a> batch generation insufficiency.</p></li>
<li><p>HBase response times are too high,</p></li>
<li><p>Network within cluster is overloaded.</p></li>
</ul>
</section>
<section id="tuning-hbase">
<h2>Tuning HBase<a class="headerlink" href="#tuning-hbase" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Increase block cache in HBase.</p></li>
<li><p>Put Thrift server on each HBase region server and spread load from SW to Thrift.</p></li>
<li><p>Enable Snappy compression (see <a href="#id1"><span class="problematic" id="id2">:setting:`HBASE_USE_SNAPPY`</span></a>).</p></li>
</ul>
</section>
<section id="tuning-kafka">
<h2>Tuning Kafka<a class="headerlink" href="#tuning-kafka" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Decrease the log size to minimum and optimize the system to avoid storing in Kafka huge volumes of data. Once data
was written it should be consumed as fast as possible.</p></li>
<li><p>Use SSD or even RAM storage for Kafka logs,</p></li>
<li><p>Enable Snappy compression for Kafka.</p></li>
</ul>
</section>
<section id="flow-control-between-various-components">
<h2>Flow control between various components<a class="headerlink" href="#flow-control-between-various-components" title="Permalink to this heading">¶</a></h2>
<p>The <a href="#id3"><span class="problematic" id="id4">:setting:`MAX_NEXT_REQUESTS`</span></a> is used for controlling the batch size. In spiders config it controls how much items
will be consumed per one <code class="xref py py-attr docutils literal notranslate"><span class="pre">get_next_requests</span></code> call. At
the same time in DB worker config it sets count of items to generate per partition. When setting these parameters keep
in mind:</p>
<ul class="simple">
<li><p>DB worker and spider values have to be consistent to avoid overloading of message bus and loosing messages. In other
words, DB worker have to produce slightly more than consumed by spiders, because the spider should still be able to
fetch new pages even though the DB worker has not pushed a new batch yet.</p></li>
<li><p>Spider consumption rate depends on many factors: internet connection latency, amount of spider
parsing/scraping work, delays and auto throttling settings, usage of proxies, etc.</p></li>
<li><p>Keep spider queue always full to prevent spider idling.</p></li>
<li><p>General recommendation is to set DB worker value 2-4 times bigger than spiders.</p></li>
<li><p>Batch size shouldn’t be big to not generate too much load on backend, and allow system quickly react on queue changes.</p></li>
<li><p>Watch out warnings about lost messages.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="scrapy-recorder.html" class="btn btn-neutral float-left" title="Recording a Scrapy crawl" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="dns-service.html" class="btn btn-neutral float-right" title="DNS Service" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2014-2018, new_frontera authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>